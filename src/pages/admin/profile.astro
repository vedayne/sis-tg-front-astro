---
import MenuLayout from '@/presentation/web/layouts/shared/MenuLayout.astro'
---

<MenuLayout
  baseUrl='/admin'
>
<div id="page-perfil" class="page min-h-screen py-8 px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between">
        <div class="">
            <p>Informaci√≥n General</p>
        </div>
        <div>
            <button class="text-white bg-navy-600 px-4 py-2 rounded">Cambiar Contrase√±a</button>
            <button class="text-white bg-amber-400 px-4 py-2 rounded">Editar</button>
        </div>
    </div>
    <!-- Contenedor principal -->
    <div class="max-w-6xl mx-auto">
        <!-- Encabezado -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-navy-900 mb-2">Mi Perfil</h1>
            <p class="text-navy-700 text-sm">Gestiona tu informaci√≥n personal y configuraci√≥n de cuenta</p>
        </div>

        <!-- Card principal del perfil -->
        <div class="glass-card rounded-2xl p-8 md:p-12 shadow-lg">
            <div class="flex flex-col md:flex-row gap-8 container-profile">
                <!-- Lado izquierdo: Foto y nombre -->
                <div class="profile-left flex flex-col items-center md:items-start">
                    <!-- Avatar -->
                    <div class="mb-6">
                        <div class="avatar-placeholder w-32 h-32 md:w-40 md:h-40 rounded-2xl shadow-lg">
                            <span id="avatarInitials">JP</span>
                        </div>
                        <button onclick="openModal('modalChangeFoto')" class="mt-4 w-full py-2 px-4 btn-secondary text-sm">
                            üì∑ Cambiar Foto
                        </button>
                    </div>

                    <!-- Informaci√≥n principal -->
                    <div class="w-full md:w-auto">
                        <h2 class="text-2xl md:text-3xl font-bold text-navy-900 mb-1" id="userName">Juan P√©rez</h2>
                        <p class="text-navy-600 font-semibold mb-4" id="userRole">Estudiante de Grado</p>
                        <p class="text-slate-700 text-sm mb-6" id="userUnit">Ingenier√≠a en Sistemas</p>
                    </div>
                </div>

                <!-- Lado derecho: Informaci√≥n detallada -->
                <div class="profile-right flex-1">
                    <div class="space-y-4">
                        <!-- Email -->
                        <div class="info-item">
                            <p class="text-xs text-slate-400 uppercase tracking-wide">Correo Personal</p>
                            <p class="text-navy-800 font-medium" id="userEmail">juan.perez@example.com</p>
                        </div>

                        <!-- Email Institucional -->
                        <div class="info-item">
                            <p class="text-xs text-slate-400 uppercase tracking-wide">Correo Institucional</p>
                            <p class="text-navy-800 font-medium" id="userInstitutionalEmail">jp202412345@emi.edu.ec</p>
                        </div>

                        <!-- Usuario -->
                        <div class="info-item">
                            <p class="text-xs text-slate-400 uppercase tracking-wide">Usuario</p>
                            <p class="text-navy-800 font-medium" id="userId">jperez2024</p>
                        </div>

                        <!-- Carnet de Identidad -->
                        <div class="info-item">
                            <p class="text-xs text-slate-400 uppercase tracking-wide">C√©dula de Identidad</p>
                            <p class="text-navy-800 font-medium" id="userCI">1234567890</p>
                        </div>

                        <!-- Rol -->
                        <div class="info-item">
                            <p class="text-xs text-slate-400 uppercase tracking-wide">Rol del Sistema</p>
                            <p class="text-navy-800 font-medium" id="userSystemRole">Estudiante</p>
                        </div>

                        <!-- Unidad Acad√©mica -->
                        <div class="info-item">
                            <p class="text-xs text-slate-400 uppercase tracking-wide">Unidad Acad√©mica</p>
                            <p class="text-navy-800 font-medium" id="userAcademicUnit">Facultad de Ingenier√≠a</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="flex flex-col sm:flex-row gap-4 mt-8 pt-8 border-t border-navy-200">
                <button onclick="openModal('modalEditProfile')" class="flex-1 py-2 px-4 btn-edit">
                    ‚úèÔ∏è Editar Perfil
                </button>
                <button onclick="openModal('modalChangePassword')" class="flex-1 py-2 px-4 btn-secondary">
                    üîê Cambiar Contrase√±a
                </button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL: Editar Perfil -->
<div id="modalEditProfile" class="modal" onclick="closeModalOnOverlay(event)">
    <div class="modal-content">
        <h3 class="text-2xl font-bold text-navy-900 mb-6">Editar Perfil</h3>
        <form onsubmit="handleEditProfile(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Nombre Completo</label>
                <input type="text" id="editName" class="form-input" value="Juan P√©rez" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Correo Personal</label>
                <input type="email" id="editEmail" class="form-input" value="juan.perez@example.com" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">C√©dula de Identidad</label>
                <input type="text" id="editCI" class="form-input" value="1234567890" required>
            </div>
            <div class="flex gap-3 mt-6">
                <button type="button" onclick="closeModal('modalEditProfile')" class="flex-1 py-2 btn-secondary">
                    Cancelar
                </button>
                <button type="submit" class="flex-1 py-2 btn-edit">
                    Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: Cambiar Contrase√±a -->
<div id="modalChangePassword" class="modal" onclick="closeModalOnOverlay(event)">
    <div class="modal-content">
        <h3 class="text-2xl font-bold text-navy-900 mb-6">Cambiar Contrase√±a</h3>
        <form onsubmit="handleChangePassword(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Contrase√±a Actual</label>
                <input type="password" id="currentPassword" class="form-input" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Nueva Contrase√±a</label>
                <input type="password" id="newPassword" class="form-input" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Confirmar Nueva Contrase√±a</label>
                <input type="password" id="confirmPassword" class="form-input" required>
            </div>
            <div class="flex gap-3 mt-6">
                <button type="button" onclick="closeModal('modalChangePassword')" class="flex-1 py-2 btn-secondary">
                    Cancelar
                </button>
                <button type="submit" class="flex-1 py-2 btn-edit">
                    Cambiar Contrase√±a
                </button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: Cambiar Foto de Perfil -->
<div id="modalChangeFoto" class="modal" onclick="closeModalOnOverlay(event)">
    <div class="modal-content">
        <h3 class="text-2xl font-bold text-navy-900 mb-6">Cambiar Foto de Perfil</h3>
        <form onsubmit="handleChangeFoto(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-3">Seleccionar Foto</label>
                <input type="file" id="photoFile" class="form-input" accept="image/*" required>
                <p class="text-xs text-slate-400 mt-2">Formatos soportados: JPG, PNG, WebP. Tama√±o m√°ximo: 5MB</p>
            </div>
            <div class="flex gap-3 mt-6">
                <button type="button" onclick="closeModal('modalChangeFoto')" class="flex-1 py-2 btn-secondary">
                    Cancelar
                </button>
                <button type="submit" class="flex-1 py-2 btn-edit">
                    Subir Foto
                </button>
            </div>
        </form>
    </div>
</div>

<script is:inline>
    // Funciones de modal
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }

    function closeModalOnOverlay(event) {
        if (event.target.classList.contains('modal')) {
            event.target.classList.remove('active');
        }
    }

    // Manejador: Editar Perfil
    function handleEditProfile(event) {
        event.preventDefault();
        const name = document.getElementById('editName').value;
        const email = document.getElementById('editEmail').value;
        const ci = document.getElementById('editCI').value;

        // Actualizar UI
        document.getElementById('userName').textContent = name;
        document.getElementById('userEmail').textContent = email;
        document.getElementById('userCI').textContent = ci;

        // Actualizar iniciales del avatar
        const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
        document.getElementById('avatarInitials').textContent = initials;

        alert('Perfil actualizado exitosamente ‚úì');
        closeModal('modalEditProfile');
    }

    // Manejador: Cambiar Contrase√±a
    function handleChangePassword(event) {
        event.preventDefault();
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (newPassword !== confirmPassword) {
            alert('Las contrase√±as no coinciden ‚úó');
            return;
        }

        if (newPassword.length < 8) {
            alert('La contrase√±a debe tener al menos 8 caracteres ‚úó');
            return;
        }

        alert('Contrase√±a actualizada exitosamente ‚úì');
        closeModal('modalChangePassword');
        
        // Limpiar formulario
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
    }

    // Manejador: Cambiar Foto
    function handleChangeFoto(event) {
        event.preventDefault();
        const fileInput = document.getElementById('photoFile');
        const file = fileInput.files[0];

        if (!file) {
            alert('Selecciona una foto primero ‚úó');
            return;
        }

        if (file.size > 5 * 1024 * 1024) {
            alert('La foto debe pesar menos de 5MB ‚úó');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const avatar = document.querySelector('.avatar-placeholder');
            avatar.style.backgroundImage = `url('${e.target.result}')`;
            avatar.style.backgroundSize = 'cover';
            avatar.style.backgroundPosition = 'center';
            avatar.textContent = ''; // Limpiar texto de iniciales

            alert('Foto actualizada exitosamente ‚úì');
            closeModal('modalChangeFoto');
        };
        reader.readAsDataURL(file);
    }
</script>
</MenuLayout>